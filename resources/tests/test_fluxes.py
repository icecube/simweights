#!/usr/bin/env python
flux_values = {
  "GaisserH3a": {
    2212:       [0.03796330552500739,    8.365286569339534e-05,  1.8506172134891679e-07, 
                 4.0584028043986314e-10, 7.549709009823797e-13,  4.0870376657174444e-16, 
                 1.4704901886070756e-19, 2.5900114285255933e-22, 1.1454509898445329e-26], 
    1000020040: [0.024903613763340826,   6.596046244172605e-05,  1.751513786239588e-07,
                 4.6303346208331554e-10, 1.1224603088706346e-12, 1.1810426598689742e-15, 
                 3.42989626776209e-19,   3.3256434063479943e-22, 1.395444976606283e-25], 
    1000070140: [0.012320299415656868,   2.925788590688458e-05,  7.006733628184314e-08, 
                 1.6972643398187752e-10, 4.0993064299519377e-13, 8.194037012850376e-16,
                 6.529966913763889e-19,  2.95390890411596e-22,   5.580774918949277e-25],
    1000130270: [0.0067667919572386446,  1.4891633330222113e-05, 3.352338611581901e-08,
                 7.828959388593794e-11,  1.9171079902222496e-13, 4.659497122239121e-16,
                 8.171418033106808e-19,  5.346873817976296e-22,  7.760121341866885e-25], 
    1000260560: [0.01188069876652913,    2.822803878597996e-05,  6.766906037675e-08, 
                 1.6447854359180513e-10, 4.062819791087999e-13,  9.76898396645905e-16, 
                 1.5547104592227743e-18, 1.2151388824430855e-21, 9.405966255819838e-25]}, 
  "GaisserH4a": {
    2212:       [0.0391982770289399,     8.671538933055752e-05,  1.9259684487470443e-07,
                 4.241403321044326e-10,  7.98443353489775e-13,   5.080654007291944e-16, 
                 3.61468317041091e-19,   7.8305407560213235e-22, 1.6929634497812248e-24], 
    1000020040: [0.024876670579742566,   6.58531997199801e-05,   1.7472435899815257e-07,
                 4.613335045827843e-10,  1.1156941787152232e-12, 1.1541667494304848e-15, 
                 2.3837520491264554e-19, 2.9026096221207127e-28, 8.291180027128277e-96],
    1000070140: [0.012302231633391867,   2.9185956774751632e-05, 6.97809814331903e-08,
                 1.6858644212470558e-10, 4.053925454122883e-13,  8.013488198418028e-16,
                 5.815795030916928e-19,  2.877635860427302e-23,  2.7952147793586243e-44], 
    1000130270: [0.006748724174914079,   1.4819704195717876e-05, 3.3237031172763456e-08, 
                 7.714959827054489e-11,  1.871725518292408e-13,  4.478888776407268e-16, 
                 7.454887852290789e-19,  2.5913687291105244e-22, 9.802770882904475e-35],
    1000260560: [0.01186263098416982,    2.815610965009247e-05,  6.738270537862618e-08, 
                 1.6333854578411072e-10, 4.0174364464099206e-13, 9.588340884913135e-16, 
                 1.4829195142961716e-18, 9.342380447274888e-22,  3.6243224170997847e-29]},
  "GaisserH4a_IT": {
    2212:       [0.0391982770289399,     8.671538933055752e-05,  1.9259684487470443e-07, 
                 4.241403321044326e-10,  7.98443353489775e-13,   5.080654007291944e-16, 
                 3.61468317041091e-19,   7.8305407560213235e-22, 1.6929634497812248e-24], 
    1000020040: [0.024876670579742566,   6.58531997199801e-05,   1.7472435899815257e-07,
                 4.613335045827843e-10,  1.1156941787152232e-12, 1.1541667494304848e-15, 
                 2.3837520491264554e-19, 2.9026096221207127e-28, 8.291180027128277e-96],
    1000080160: [0.019050955808305944,   4.400566097046951e-05,  1.0301801260595376e-07, 
                 2.457360403952505e-10,  5.925650972415291e-13,  1.2492376974825297e-15,
                 1.3270682883207717e-18, 2.8791323151532543e-22, 9.80277088569969e-35],
    1000260560: [0.01186263098416982,    2.815610965009247e-05,  6.738270537862618e-08,
                 1.6333854578411072e-10, 4.0174364464099206e-13, 9.588340884913135e-16,
                 1.4829195142961716e-18, 9.342380447274888e-22,  3.6243224170997847e-29]}, 
  "GaisserHillas": {
    2212:       [0.037619384760184185,   8.22837303726266e-05,   1.79612604239526e-07, 
                 3.842069211166477e-10,  6.711953291327474e-13,  1.5476984272934861e-16,
                 5.728758286620463e-29,  2.4088073641761418e-129,0.0], 
    1000020040: [0.024559692469547634,   6.459130606275594e-05,  1.6970142336083984e-07,
                 4.4136681015376554e-10, 1.0373887711550115e-12, 8.858501247661093e-16,
                 3.030730567774803e-23,  1.105142078693139e-74,  0.0], 
    1000070140: [0.012089856046733334,   2.8340477959247355e-05, 6.641521389342832e-08, 
                 1.5519282155805327e-10, 3.5229961097279023e-13, 5.988492482535734e-16, 
                 5.641193018275147e-20,  1.4517955804497705e-36, 8.654671185935402e-179],
    1000130270: [0.006536348541579588,   1.397422352201636e-05,  2.9871189659275634e-08,
                 6.375303372751875e-11,  1.3396280129943556e-13, 2.408894987136264e-16, 
                 9.123350114084174e-20,  5.936344249271506e-30,  8.652994759337875e-108],
    1000260560: [0.01165025532360768,    2.7310627892440676e-05, 6.401682071304747e-08,
                 1.4994026362270845e-10, 3.484656327343595e-13,  7.49163786656022e-16, 
                 7.39171158516475e-19,   3.022925061261307e-25,  1.8503379770274108e-65]},
  "GlobalFitGST": {
    2212:       [0.03607536338982165,    8.303604540195788e-05,  1.8863983153209037e-07, 
                 3.1276596162531363e-10, 5.209459034660495e-13,  4.1532872002068553e-16,
                 8.179387207124814e-19,  1.6295037238885218e-21, 6.3885346081344595e-27], 
    1000020040: [0.023762074349477715,   6.617029782920994e-05,  1.878720144259654e-07, 
                 4.685738192425947e-10,  9.255593536028597e-13,  1.4792625219449634e-15,
                 9.643447774808006e-23,  6.700436854786504e-74,  0.0], 
    1000070140: [0.0017354171735606382,  7.057394787724868e-06,  2.8605995395438496e-08,
                 1.0768257625054734e-10, 2.1281233038278767e-13, 3.334725018391924e-16, 
                 6.715827450544889e-20,  3.695166734544039e-36,  4.709547072475624e-178],
    1000130270: [0.0022360607920672458,  9.078420026607147e-06,  3.686172134626586e-08, 
                 1.4402155925146982e-10, 3.814442121641842e-13,  4.621424823948669e-16,
                 4.07301813755149e-19,   6.212709978058719e-29,  2.1228946532983858e-106],
    1000260560: [0.0015996433832794234,  8.135139888332144e-06,  4.1420823134587994e-08, 
                 2.0697967478899172e-10, 8.354760133167253e-13,  1.0349313641570426e-15,
                 2.2713129512457712e-18, 3.871036212755032e-22,  1.8597326553441085e-24]}, 
  "Hoerandel": {
    2212:       [0.04477279875079687,    8.72999889028403e-05,   1.7021971482865675e-07, 
                 3.3163934382124646e-10, 6.082946750995586e-13,  1.887591881888407e-16,
                 3.625880951558085e-21,  5.632678253372135e-26,  8.724315257396413e-31], 
    1000020040: [0.024925054010225975,   5.7099998055191935e-05, 1.3080818907704846e-07,
                 2.996006743304879e-10,  6.749618807325178e-13,  6.491665697336477e-16,
                 2.2574375098370186e-20, 4.153884410784659e-25,  7.5598927539837e-30], 
    1000030070: [0.0007212126487981361,  2.079999967210818e-06,  5.998778014944407e-09, 
                 1.72989658011378e-11,   4.950445649659679e-14,  8.754136003837333e-17, 
                 6.01463027188606e-21,   1.4112414444616977e-25, 3.233952220783829e-30], 
    1000040090: [0.0002665497881096015,  4.739999956742442e-07,  8.429038293296163e-10, 
                 1.4988333054764115e-12, 2.653359125982931e-15,  3.4622155584696986e-18,
                 2.1967532266579833e-22, 3.232885019054158e-27,  4.5689744132285045e-32], 
    1000050110: [0.0007976695895697266,  8.949999946546313e-07,  1.0042060401939781e-09, 
                 1.126695785306093e-12,  1.2604476290356854e-15, 1.1436548856818319e-18, 
                 6.487509080431103e-23,  6.152106585027874e-28,  5.4874794704684166e-33], 
    1000060120: [0.004845134809660035,   1.0599999955227006e-05, 2.319026543321316e-08, 
                 5.073343769772009e-11,  1.1076112688094469e-13, 2.076472592733502e-16, 
                3.09727046168351e-20,    5.87003954058591e-25,   1.0212557436802286e-29],
    1000070140: [0.001233297531538036,   2.349999992594077e-06,  4.477831566281988e-09, 
                 8.53216463040031e-12,   1.62323873209498e-14,   2.7507889325329383e-17, 
                 4.623870805945532e-21,  7.849126528396077e-26,  1.1898237268912763e-30], 
    1000080160: [0.007514492449234098,   1.5699999961609277e-05, 3.2801942883135e-08, 
                 6.853192830885277e-11,  1.4301042688636346e-13, 2.7250925176310856e-16, 
                 6.280248359971629e-20,  1.2057102847689287e-24, 2.0049108555565256e-29],
    1000090190: [0.00016064745274889662, 3.279999993587747e-07,  6.696899418570373e-10, 
                 1.367314712034205e-12,  2.788999979165903e-15,  5.287014051179115e-18, 
                 1.4472607246187798e-21, 2.808156179239398e-26,  4.565484036525242e-31], 
    1000100200: [0.002007972828264311,   4.599999992638684e-06,  1.0537989863192562e-08,
                 2.414089941774206e-11,  5.525984153166786e-14,  1.1908514854179152e-16,
                 4.341618796976597e-20,  9.798444313652245e-25,  1.788374762138938e-29], 
    1000110230: [0.00034464449496382266, 7.539999989932472e-07,  1.6495720895043773e-09, 
                 3.6088404929050607e-12, 7.890069103187077e-15,  1.6399249525374954e-17,
                 6.643622103637866e-21,  1.487421503362271e-25,  2.594139860641442e-30],
    1000120240: [0.0034964918161939132,  8.009999990934624e-06,  1.834984824904286e-08, 
                 4.2036777385255007e-11, 9.624678641720522e-14,  2.1108298811689963e-16,
                 1.0243433482522297e-19, 2.499009166404175e-24,  4.566747031783928e-29],
    1000130270: [0.0005256514180506736,  1.1499999988820997e-06, 2.5159256732731727e-09, 
                 5.504212301854768e-12,  1.2036114198769084e-14, 2.5361702830955292e-17,
                 1.325131827513823e-20,  3.217572531277443e-25,  5.619126946719814e-30], 
    1000140280: [0.004476236948467595,   7.959999993278482e-06,  1.415510315447006e-08, 
                 2.5171596063680505e-11, 4.47434333024542e-14,   7.700717028383368e-17, 
                 3.641177718151701e-20,  7.49901942967444e-25,   1.0652898046394148e-29], 
    1000150310: [0.00013224028122824742, 2.699999998000194e-07,  5.512692126277081e-10, 
                 1.125542075365779e-12,  2.2972199280584617e-15, 4.557490272612637e-18,
                 2.724746124914936e-21,  6.730224366761691e-26,  1.0985929959807237e-30],
    1000160320: [0.0008125226613381855,  2.289999998499607e-06,  6.454096576699363e-09, 
                 1.8190041377677593e-11, 5.124988464498242e-14,  1.4081180465350252e-16, 
                 1.267622937381045e-19,  4.5184751924401216e-24, 1.0189765288531724e-28], 
    1000170350: [0.00014071724714182136, 2.93999999828331e-07,   6.142530339811165e-10,
                 1.2833518186441892e-12, 2.6805274073534887e-15, 5.474651794347659e-18, 
                 3.952098685728916e-21,  1.0924554985689692e-25, 1.8279396189228425e-30],
    1000180400: [0.0003649272357503725,  8.35999999562089e-07,   1.915165278027103e-09,
                 4.387375867127365e-12,  1.0048292656398181e-14, 2.2554545285746848e-17,
                 1.9170253599382556e-20, 6.081077710408069e-25,  1.116722059756283e-29], 
    1000190390: [0.00023942240539149155, 5.359999997466446e-07,  1.1999544852189187e-09, 
                 2.686355560455818e-12,  6.012594512913e-15,     1.3214817515562652e-17, 
                 1.1709824601749373e-20, 3.8002919317963616e-25, 6.82666226484604e-30], 
    1000200400: [0.0007367452334281136,  1.469999999369685e-06,  2.9330355031059807e-09, 
                 5.8521595743676105e-12, 1.1674116232711292e-14, 2.2906591591772156e-17, 
                 1.9188338591099153e-20, 5.811616706585664e-25,  9.313987137756594e-30], 
    1000210450: [0.00013270081300035763, 3.039999998811896e-07,  6.964237448214595e-10,
                 1.5954107449854387e-12, 3.654168111124975e-15,  8.244484879592971e-18,
                 8.367519941990654e-21,  3.047034512198433e-25,  5.612849379580054e-30], 
    1000220480: [0.00046033971391657395, 1.1299999995957287e-06, 2.773820995897451e-09, 
                 6.80890795270414e-12,   1.6710928392854358e-14, 4.0451292354612804e-17,
                 4.6209462439733087e-20, 1.8880597832445672e-24, 3.73086103018983e-29], 
    1000230510: [0.0002691716763626908,  6.309999997925356e-07,  1.4792083438351461e-09, 
                 3.4675957204917455e-12, 8.127515377054927e-15,  1.8809539672929126e-17,
                 2.1466471134288166e-20, 8.769883105936747e-25,  1.6568922451207224e-29], 
    1000240520: [0.0006361197921481612,  1.3599999995875846e-06, 2.9076283716848033e-09,
                 6.216387484585124e-12,  1.3288406572563311e-14, 2.807529488863053e-17, 
                 3.045742428952607e-20,  1.1879137438447493e-24, 2.0493312200886844e-29],
    1000250550: [0.00038934425292071634, 1.349999999621169e-06,  4.680947376770487e-09,
                 1.623054113012085e-11,  5.626945292913163e-14,  1.9297737815880448e-16, 
                 3.527161837807159e-19,  2.3348383216217848e-23, 6.540792273239672e-28], 
    1000260560: [0.0079365209578573,     2.0399999994686533e-05, 5.2436072883613e-08, 
                 1.3478124189148825e-10, 3.4639648573695985e-13, 8.813488514130857e-16,
                 1.2368669191069047e-18, 6.349656690551557e-23,  1.3203511220096466e-27]}, 
  "Hoerandel5": {
    2212:       [0.04477279875079687,    8.72999889028403e-05,   1.7021971482865675e-07, 
                 3.3163934382124646e-10, 6.082946750995586e-13,  1.887591881888407e-16,
                 3.625880951558085e-21,  5.632678253372135e-26,  8.724315257396413e-31], 
    1000020040: [0.024925054010225975,   5.7099998055191935e-05, 1.3080818907704846e-07, 
                 2.996006743304879e-10,  6.749618807325178e-13,  6.491665697336477e-16, 
                 2.2574375098370186e-20, 4.153884410784659e-25,  7.5598927539837e-30],
    1000070140: [0.015507614990638236,   3.239999989789281e-05,  6.769317769409718e-08, 
                 1.414283174331752e-10,  2.9502549301526346e-13, 5.481941747146868e-16,
                 1.0103755751764824e-19, 1.8806088603684068e-24, 3.125789824753169e-29],
    1000130270: [0.014780430464494586,   3.159999996928205e-05,  6.755959681161303e-08, 
                 1.4443898200785533e-10, 3.0865658154083993e-13, 6.355762375728781e-16,
                 3.2452512615437925e-19, 7.700476288697505e-24,  1.3141897815007204e-28],
    1000260560: [0.008288128839761058,   2.1799999994321882e-05, 5.733984103699135e-08,
                 1.5081890380166746e-10, 3.9664300851925534e-13, 1.0326999810388352e-15, 
                 1.4830278279817426e-18, 7.79070161149543e-23,   1.6577375121105536e-27]},
  "Hoerandel_IT": {
    2212:       [0.04477279875079687,    8.72999889028403e-05,   1.7021971482865675e-07, 
                 3.3163934382124646e-10, 6.082946750995586e-13,  1.887591881888407e-16, 
                 3.625880951558085e-21,  5.632678253372135e-26,  8.724315257396413e-31], 
    1000020040: [0.024925054010225975,   5.7099998055191935e-05, 1.3080818907704846e-07, 
                 2.996006743304879e-10,  6.749618807325178e-13,  6.491665697336477e-16,
                 2.2574375098370186e-20, 4.153884410784659e-25,  7.5598927539837e-30], 
    1000080160: [0.03063232590770588,    6.39999998435028e-05,   1.3371492640258854e-07,
                 2.793658224055145e-10,  5.829724408106538e-13,  1.1108657396712708e-15, 
                 2.560101242281429e-19,  4.9149973391854425e-24, 8.17288501628138e-29], 
    1000260560: [0.008288128839761058,   2.1799999994321882e-05, 5.733984103699135e-08,
                 1.5081890380166746e-10, 3.9664300851925534e-13, 1.0326999810388352e-15, 
                 1.4830278279817426e-18, 7.79070161149543e-23,   1.6577375121105536e-27]}, 
  "Honda2004": {
    2212:       [0.04898822257085391,    9.620174808364391e-05,  1.875798863572479e-07, 
                 3.6575162843706925e-10, 7.131588375607307e-13,  1.3905489081875158e-15, 
                 2.711354279328874e-18,  5.286719499580272e-21,  1.030828146669215e-23], 
    1000020040: [0.0288917853099261,     7.054218610782245e-05,  1.6183835031222142e-07,
                 3.707506980932247e-10,  8.493407815028677e-13,  1.9457273225214198e-15, 
                 4.457403784270766e-18,  1.0211322144710558e-20, 2.3392787593308656e-23], 
    1000070140: [0.010411706100257183,   3.502127494161148e-05,  9.062099368669749e-08, 
                 2.2821401640610884e-10, 5.733338295239291e-13,  1.4401530193352443e-15, 
                 3.617500831365582e-18,  9.086751254281827e-21,  2.2824887182133183e-23],
    1000130270: [0.009412280747908225,   4.628523146723063e-05,  8.592294666292657e-08, 
                 1.4109705806864827e-10, 2.2902923487452303e-13, 3.714507338146555e-16, 
                 6.024225732976165e-19,  9.770150122510318e-22,  1.5845328121399818e-24],
    1000260560: [0.0026424636032919965,  3.262430182026922e-05,  7.389423802961229e-08,
                 1.54417157479088e-10,   3.2262316970500335e-13, 6.740553401885294e-16, 
                 1.4083012142373972e-18, 2.9423582779832397e-21, 6.1474577657767335e-24]},
  "TIG1996": {
    2212:       [0.06767821899409447,    0.0001350357999031277,  2.694318427183888e-07, 
                 5.375872022286233e-10,  1.0726274856163258e-12, 1.7399999999999999e-15, 
                 1.74e-18,               1.74e-21,               1.7400000000000002e-24]},
  "FixedFractionFlux":{
    2212:       [0.009498853440115824,   2.247303596710996e-05,  5.377219218574369e-08, 
                 1.294548422866578e-10,  2.9084462740875196e-13, 3.870303936133522e-16, 
                 3.40983132457068e-19,   2.0052056421059088e-22, 1.6929996931034236e-25], 
    1000020040: [0.018997706880231648,   4.494607193421992e-05,  1.0754438437148739e-07, 
                 2.589096845733156e-10,  5.816892548175039e-13,  7.740607872267044e-16, 
                 6.81966264914136e-19,   4.0104112842118176e-22, 3.385999386206847e-25], 
    1000080160: [0.028496560320347468,   6.741910790132988e-05,  1.6131657655723107e-07, 
                 3.8836452685997344e-10, 8.725338822262557e-13,  1.1610911808400565e-15, 
                 1.0229493973712039e-18, 6.0156169263177265e-22, 5.07899907931027e-25], 
    1000260560: [0.037995413760463295,   8.989214386843984e-05,  2.1508876874297477e-07, 
                 5.178193691466312e-10,  1.1633785096350078e-12, 1.5481215744534088e-15, 
                 1.363932529828272e-18,  8.020822568423635e-22,  6.771998772413694e-25]}
}

from icecube.simweights import fluxes

import numpy as np
import unittest

E=np.logspace(2,10,9)

class TestCosmicRayModels(unittest.TestCase):
    def flux_cmp(self,name):
        if name=="FixedFractionFlux":
            args = ({2212:.1,1000020040:.2,1000080160:.3,1000260560:.4},)
        else:
            args = ()
        flux = getattr(fluxes,name)(*args)
        v1 = flux(*np.meshgrid(E,list(flux_values[name].keys())))
        v2 = np.array(list(flux_values[name].values()))
        assert ((abs(v1-v2)<1e-17).all())
        assert ((abs(v1[v2!=0]/v2[v2!=0]-1)<1e-13).all())
    
    def test_corsika_to_pdg(self):
        c = [14,  402,  703,  904, 1105, 1206, 1407, 1608, 1909, 2010, 2311, 2412, 2713, 
           2814, 3115, 3216, 3517, 4018, 3919, 4020, 4521, 4822, 5123, 5224, 5525, 5626]
        pdg = list(flux_values["Hoerandel"].keys())
        assert np.all(fluxes.corsika_to_pdg(c) == pdg)

for m in flux_values.keys():
    setattr(TestCosmicRayModels,'test_'+m,lambda self,m=m: self.flux_cmp(m))

if __name__ == '__main__':
    unittest.main()
